<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Hóa đơn tạm</title>
  <style>
    body { margin:0; background:#f2f2f2; font-family: Arial, Helvetica, sans-serif; font-size:12px; }
    .receipt{
      width: 360px;
      background:#fff;
      margin: 20px auto;
      padding: 14px 12px;
      border-radius: 12px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.08);
      box-sizing: border-box;
    }
    .center{ text-align:center; }
    .right{ text-align:right; }
    .bold{ font-weight:700; }
    .muted{ color:#666; font-size:11px; }
    hr{ border:none; border-top:1px dashed #999; margin:8px 0; }
    table{ width:100%; border-collapse:collapse; }
    th,td{ padding:4px 0; vertical-align:top; }
    th{ text-align:left; border-bottom:1px solid #ddd; }
    .desc{ margin-top:2px; font-size:11px; color:#444; line-height:1.25; }
    .total{ font-size:16px; font-weight:800; text-align:right; margin-top:4px; }
    .kv{ display:flex; justify-content:space-between; gap:10px; }
    .kv .v{ text-align:right; font-weight:700; }
  </style>
</head>

<body>
  <div class="receipt">
    {% if empty_cart %}
      <div class="muted">Giỏ hàng đang trống nên không in được.</div>
    {% else %}

      <div class="center bold" style="font-size:16px;">HÓA ĐƠN TẠM</div>
      <div class="center muted">Trạng thái: <b>CHỜ THANH TOÁN</b></div>

      {% if khach %}
        <div class="center" style="margin-top:6px;">
          Khách: <b>{{ khach.name }}</b>
          {% if khach.sdt %}&nbsp; SĐT: <b>{{ khach.sdt }}</b>{% endif %}
        </div>
      {% else %}
        <div class="center muted" style="margin-top:6px;">Khách: Chưa có thông tin</div>
      {% endif %}

      <hr>

      <div>
        <div>Mã HĐ: <b>#{{ bill.id }}</b></div>
        <div>Loại:
          <b>
            {% if bill.loaiHoaDon %}
              {% if bill.loaiHoaDon.value == "TAI_QUAN" %}Tại quán
              {% elif bill.loaiHoaDon.value == "MANG_DI" %}Mang đi
              {% elif bill.loaiHoaDon.value == "TAI_NHA" %}Tại nhà
              {% else %}{{ bill.loaiHoaDon.value }}{% endif %}
            {% else %}
              Tại quán
            {% endif %}
          </b>
        </div>
        <div>Thời gian: <b>{{ (bill.ngayTao or now).strftime("%d/%m/%Y %H:%M:%S") }}</b></div>
      </div>

      <hr>

      <table>
        <thead>
          <tr>
            <th>Tên món</th>
            <th class="right">SL</th>
            <th class="right">Tiền</th>
          </tr>
        </thead>
        <tbody>
          {% if items and items|length > 0 %}
            {% for it in items %}
            <tr>
              <td>
                <div class="bold">{{ it.ten }}</div>
                {% if it.desc %}
                <div class="desc">
                  {% for d in it.desc %}
                    {{ d }}{% if not loop.last %}<br>{% endif %}
                  {% endfor %}
                </div>
                {% endif %}
              </td>
              <td class="right">{{ it.sl }}</td>
              <td class="right">{{ "{:,.0f}".format(it.tien).replace(",", ".") }}</td>
            </tr>
            {% endfor %}
          {% else %}
            <tr><td colspan="3" class="muted">Không có món.</td></tr>
          {% endif %}
        </tbody>
      </table>

      <hr>

      <div class="kv"><div>Tổng số món:</div><div class="v">{{ total_qty }}</div></div>
      <div class="kv"><div>Tiền hàng:</div><div class="v">{{ "{:,.0f}".format(subtotal).replace(",", ".") }}</div></div>
      <div class="kv"><div>Thuế ({{ (tax_rate*100)|round(0) }}%):</div><div class="v">{{ "{:,.0f}".format(tax_amount).replace(",", ".") }}</div></div>
      <div class="kv"><div>Phí phục vụ ({{ service_percent }}%):</div><div class="v">{{ "{:,.0f}".format(service_fee).replace(",", ".") }}</div></div>

      <hr>

      <div class="total">
        TỔNG THANH TOÁN: {{ "{:,.0f}".format(grand_total).replace(",", ".") }}đ
      </div>

      <hr>

      <div class="center muted">
        Cảm ơn quý khách!<br>
        (Hóa đơn tạm - chưa phải hóa đơn tài chính)
      </div>

    {% endif %}
  </div>
</body>
</html>
